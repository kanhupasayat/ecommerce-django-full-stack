{% extends 'base.html' %} 
{% block title %}
        checkout page
{% endblock title  %} 


{% block body %}

        <!-- Modal Search Start -->
        <!-- Single Page Header End -->


        <!-- Checkout Page Start -->
        <div class="container-fluid py-5">
            <div class="container py-5">
                <h1 class="mb-4">Billing details</h1>
                <form method="Post" action="">
                {% csrf_token %}
                <input type="hidden" name="cart" id="cartInput">
                    <div class="row g-5">
                        <div class="col-md-10 col-lg-4 col-xl-6">
                            <div class="row">
                                <div class="col-md-12 col-lg-6">
                                    <div class="form-item w-100">

                                        <label class="form-label my-3">Name<sup>*</sup></label>
                                        <input type="text" class="form-control" id="name" name="name" required>
                                        <input type="hidden" name="amt" id="amtInput">
                                        


                                    </div>
                                </div>
                                <div class="col-md-12 col-lg-6">
                                    <div class="form-item w-100">
                                        <label class="form-label my-3">Email Address<sup>*</sup></label>
                                        <input type="email" class="form-control" value="{{user.username}}" id="email" name="email" required>
                                    </div>
                                </div>
                            </div>
                            <div class="form-item">
                                <label class="form-label my-3">Address<sup>*</sup></label>
                                <input type="text " class="form-control" id="address1"  name="address1" required>
                            </div>
                            <div class="form-item">
                                <label class="form-label my-3">City<sup>*</sup></label>
                                <input type="text" class="form-control" placeholder="City" id=city" name="city" required>
                            </div>
                            <div class="form-item">
                                <label class="form-label my-3">State<sup>*</sup></label>
                                <input type="text" class="form-control" id="state" name="state" required>
                            </div>
                
                            <div class="form-item">
                                <label class="form-label my-3">Postcode/Zip<sup>*</sup></label>
                                <input type="text" class="form-control"id="zip_code" name="zip_code" required>
                                <input type="hidden" name="oid" id="oid" value="">

                            </div>
                            <div class="form-item">
                                <label class="form-label my-3">Mobile<sup>*</sup></label>
                                <input type="tel" class="form-control" id="phone" name="phone" required>
                            </div>                           
                            <hr>
                        </div>
                        <div class="col-md-12 col-lg-8 col-xl-6">
                            <div class="table">

                            
                                <table class="table text-light bg-dark ">
                                    <thead>
                                        <tr>
                                            <th scope="col">Products</th>
                                            <th scope="col">Name</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Total</th>
                                            </tr>
                                            </thead>
                                            <tbody id="cartItems">
            <!-- Cart items will be displayed here dynamically using JavaScript -->
                                            </tbody>
                                            <tfoot>
                                            <tr>
                                    <th scope="row"></th>
                                    <td class="py-5">
                                <p class="mb-0 text-light text-uppercase py-3 ">TOTAL</p>
                                </td>
                                <td class="py-5"></td>
                                <td class="py-5"></td>
                                <td class="py-5" id="totalAmount">
                                <div class="py-3 border-bottom border-top">
                            <p class="mb-0 text-light"></p>
                        </div>
                    </td>
                </tr>
            </tfoot>
        </table>
        <button id="deleteLocalStorageButton"class="btn btn-outline-danger">ALL Delete</button>
                                






                            </div>
                            <div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
                                <div class="col-12">
                                    <div class="form-check text-start my-3">
                                        <input type="checkbox" class="form-check-input bg-primary border-0" id="Transfer-1" name="Transfer" value="Transfer">
                                        <label class="form-check-label" for="Transfer-1">Direct Bank Transfer</label>
                                    </div>
                                    <p class="text-start text-dark">Make your payment directly into our bank account. Please use your Order ID as the payment reference. Your order will not be shipped until the funds have cleared in our account.</p>
                                </div>
                            </div>
                            <div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
                                <div class="col-12">
                                    <div class="form-check text-start my-3">
                                        <input type="checkbox" class="form-check-input bg-primary border-0" id="Payments-1" name="Payments" value="Payments">
                                        <label class="form-check-label" for="Payments-1">Check Payments</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
                                <div class="col-12">
                                    <div class="form-check text-start my-3">
                                        <input type="checkbox" class="form-check-input bg-primary border-0" id="Delivery-1" name="Delivery" value="Delivery">
                                        <label class="form-check-label" for="Delivery-1">Cash On Delivery</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-4 text-center align-items-center justify-content-center border-bottom py-3">
                                <div class="col-12">
                                    <div class="form-check text-start my-3">
                                        <input type="checkbox" class="form-check-input bg-primary border-0" id="Paypal-1" name="Paypal" value="Paypal">
                                        <label class="form-check-label" for="Paypal-1">Paypal</label>
                                    </div>
                                </div>
                            </div>
                            <div class="row g-4 text-center align-items-center justify-content-center pt-4">
                                                        <!-- Your form fields go here -->
                                                <button type="submit" id="rzp-button1" class="btn border-secondary py-3 px-4 text-uppercase w-100 text-primary">Place Order</button>
                                                
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- Checkout Page End -->

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>


<script>

var xx=0;

   $(document).ready(function () {
            // Initialize cart object from local storage
            var cart = JSON.parse(localStorage.getItem('cart')) || {};

            // Function to update cart count in the UI
            function updateCartCount() {
                var cartCount = Object.keys(cart).length;
                $('#cartCount').text(cartCount);
            }

            // Function to save cart to local storage
            function saveCartToLocalStorage() {
                localStorage.setItem('cart', JSON.stringify(cart));
            }

            // Add to cart click event
            $('.btn-add-to-cart').on('click', function () {
                var productImage = $(this).data('product-image');
                var productId = $(this).data('product-id');
                var productName = $(this).data('product-name');
                var productPrice = parseFloat($(this).data('product-price'));

                if (cart[productId]) {
                    cart[productId][0]++; // Increment quantity if product already exists in cart
                } else {
                    cart[productId] = [1, productName, productPrice, productImage]; // Add new product to cart
                }

                saveCartToLocalStorage(); // Save cart to local storage
                updateCartCount(); // Update cart count in UI

                // Log the cart object (optional)
                console.log(cart);
            });
             $('#deleteLocalStorageButton').on('click', function () {
                localStorage.removeItem('cart'); // Remove the 'cart' key from local storage
                cart = {}; // Clear the cart object
                updateCartCount(); // Update cart count in UI
            });

            // Display cart count on page load
            updateCartCount();
        });














 $(document).ready(function () {
        var cart = JSON.parse(localStorage.getItem('cart')) || {};
        console.log("kanhu", cart);

        var x;  // Declare x in the outer scope

        function displayCartItems() {
            var cartItemsContainer = $('#cartItems');
            var totalAmountElement = $('#totalAmount');

            cartItemsContainer.empty();

            var totalAmount = 0;

            for (var productId in cart) {
                var item = cart[productId];
                var productName = item[1];
                var productPrice = item[2];
                var quantity = item[0];

                var totalPrice = quantity * productPrice;
                totalAmount += totalPrice;

               var rowHtml = '<tr class="text-light bg-dark">';
rowHtml += '<td class="text-center" style="border-radius: 8px 0px 0px 0px;"><div class="d-flex justify-content-center align-items-center"><img src="' + item[3] + '" class="img-fluid rounded-circle" style="width: 100px; height: 85px;" alt=""></div></td>';
rowHtml += '<td style="position: relative; top:20px;">' + productName + '</td>';
rowHtml += '<td style="position: relative; top: 20px;">₹' + productPrice.toFixed(2) + '</td>';
rowHtml += '<td style="position: relative; top: 20px;"><button class="quantity-btn btn btn-danger" data-product-id="' + productId + '">-</button>' + quantity + "Kg" + '<button class="quantity-btn btn btn-success" data-product-id="' + productId + '">+</button></td>';
rowHtml += '<td style="position: relative; top: 20px;">₹' + totalPrice.toFixed(2) + '</td>';
rowHtml += '</tr>';


                    cartItemsContainer.append(rowHtml);
            }

            totalAmountElement.find('p').text('₹' + totalAmount.toFixed(2));

            $('#cartInput').val(JSON.stringify(cart));
            $('#amtInput').val(totalAmount.toFixed(2));
            x = (totalAmount * 100).toFixed(2);  // Assign value to x

            // Add event listeners for quantity buttons
            $('.quantity-btn').on('click', function () {
                var productId = $(this).data('product-id');
                var action = $(this).text();

                if (action === '+') {
                    cart[productId][0]++;
                } else if (action === '-' && cart[productId][0] > 0) {
                    cart[productId][0]--;
                }

                localStorage.setItem('cart', JSON.stringify(cart));

                displayCartItems();
            });

            console.log("kanhu1");

            // Razorpay options with corrected amount
            var options = {
                "key": "rzp_test_q24PwMMyrNqTTl",
                "amount": x,  // Set the amount in paisa
                "currency": "INR",
                "name": "Kanhu Pasayat",
                "description": "Fruitables Shop",
                "image": "https://example.com/your_logo",
                "handler": function (response) {
                    $('#oid').val(response.razorpay_payment_id);
                },
                "prefill": {
                    "name": "{{name}}",
                    "email": "{{email}}",
                    "contact": "{{phone}}"
                },
                "theme": {
                    "color": "#3399cc"
                }
            };

            var rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response) {
                alert(response.error.metadata.order_id);
                alert(response.error.metadata.payment_id);
            });

            document.getElementById('rzp-button1').onclick = function (e) {
                rzp1.open();
                e.preventDefault();
            };
        }

        // Display cart items on page load
        displayCartItems();
    });

</script>



{% endblock body %}
